#!/bin/bash
set -e

BOT_DIR="/opt/discord-bot"
BACKUP_DIR="/root/discord-bot-backup"

# Bestanden die gebackupt moeten worden
BACKUP_FILES=(
    "config.json"
    "data.json"
    "quiz-data.json"
    "used-questions.json"
    "quizlijst.json"
    "quiz-scores.json"
)

# Ga naar /opt zodat we niet in BOT_DIR zitten bij verwijderen
cd /opt

echo ">>> Stap 1: Maak backup van belangrijke bestanden"
mkdir -p "$BACKUP_DIR"

for file in "${BACKUP_FILES[@]}"; do
    if [ -f "$BOT_DIR/$file" ]; then
        cp "$BOT_DIR/$file" "$BACKUP_DIR/$file"
        echo "✓ Backup gemaakt: $file"
    else
        echo "⚠ Geen $file gevonden om te backuppen"
    fi
done



echo ">>> Stap 2: Verwijder oude bot map"
rm -rf "$BOT_DIR"

echo ">>> Stap 3: Clone de nieuwste code van GitHub"
git clone https://github.com/KimpiegamesYT1/Vissstick.git "$BOT_DIR"

echo ">>> Stap 4: Zet backup terug"
for file in "${BACKUP_FILES[@]}"; do
    if [ -f "$BACKUP_DIR/$file" ]; then
        cp "$BACKUP_DIR/$file" "$BOT_DIR/$file"
        echo "✓ Teruggezet: $file"
    fi
done

echo ">>> Stap 5: Installeer dependencies"
cd "$BOT_DIR"
npm install --production

echo ">>> Stap 6: Start bot in deze terminal"
echo "De bot draait nu. Gebruik CTRL+C om te stoppen."
node bot.js